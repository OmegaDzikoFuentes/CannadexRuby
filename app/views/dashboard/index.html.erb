<% content_for :title, "Dashboard - Cannadex" %>

<div class="dashboard-container">
  <!-- Header with User Profile -->
  <header class="header">
    <div class="user-profile">
      <div class="avatar" data-initials="<%= current_user.first_name.first.upcase %><%= current_user.last_name.first.upcase %>">
        <%= current_user.first_name.first.upcase %><%= current_user.last_name.first.upcase %>
      </div>
      <div class="user-info">
        <h2>Welcome back, <%= current_user.first_name %>!</h2>
        <span class="level-badge">
          Level <%= current_user.level %> Explorer
        </span>
        <div class="xp-bar">
          <div class="xp-fill" style="width: <%= (current_user.experience_points.to_f / current_user.xp_for_next_level.to_f) * 100 %>%"></div>
          <span class="xp-text"><%= current_user.experience_points %>/<%= current_user.xp_for_next_level %> XP</span>
        </div>
      </div>
    </div>
    <div class="header-actions">
      <%= link_to notifications_path, class: "icon-btn" do %>
        <span class="badge"><%= current_user.unread_notifications_count if current_user.unread_notifications_count > 0 %></span>
        🔔
      <% end %>
    </div>
  </header>

  <!-- Quick Stats -->
  <section class="quick-stats">
    <div class="stat-card">
      <div class="stat-icon">🌿</div>
      <div class="stat-value"><%= current_user.total_encounters %></div>
      <div class="stat-label">Strains Tried</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">⚔️</div>
      <div class="stat-value"><%= current_user.battles_won %></div>
      <div class="stat-label">Battles Won</div>
    </div>
    <div class="stat-card">
      <div class="stat-icon">🏆</div>
      <div class="stat-value"><%= current_user.achievements.unlocked.count %></div>
      <div class="stat-label">Achievements</div>
    </div>
  </section>

  <!-- Action Grid -->
  <section class="action-grid">
    <%= link_to new_encounter_path, class: "action-btn accent" do %>
      <div class="action-icon">📸</div>
      <div class="action-text">New Encounter</div>
      <div class="action-desc">Log your latest find</div>
    <% end %>
    
    <%= link_to new_battle_path, class: "action-btn primary" do %>
      <div class="action-icon">⚔️</div>
      <div class="action-text">Start Battle</div>
      <div class="action-desc">Challenge a sesh pal</div>
    <% end %>
    
    <%= link_to map_encounters_path, class: "action-btn" do %>
      <div class="action-icon">🗺️</div>
      <div class="action-text">Explore Map</div>
      <div class="action-desc">Nearby discoveries</div>
    <% end %>
    
    <%= link_to friendships_path, class: "action-btn" do %>
      <div class="action-icon">👥</div>
      <div class="action-text">Sesh Pals</div>
      <div class="action-desc">Connect with friends</div>
    <% end %>
  </section>

  <!-- Recent Activity -->
  <section class="recent-section">
    <div class="section-header">
      <h3 class="section-title">Recent Encounters</h3>
      <%= link_to "View All", encounters_path, class: "view-all" %>
    </div>
    
    <% if @dashboard_data[:recent_encounters].any? %>
      <div class="activity-cards">
        <% @dashboard_data[:recent_encounters].each do |encounter| %>
          <div class="activity-card">
            <div class="activity-header">
              <div class="strain-name"><%= encounter[:strain] %></div>
              <div class="rating-display">
                <span class="stars"><%= render_star_rating(encounter[:rating]) %></span>
                <span class="rating-value"><%= encounter[:rating] %></span>
              </div>
            </div>
            <div class="activity-details">
              <span class="detail-item"><%= encounter[:location] %></span>
              <span class="detail-item"><%= time_ago_in_words(encounter[:created_at]) %> ago</span>
            </div>
          </div>
        <% end %>
      </div>
    <% else %>
      <div class="empty-state">
        <p>No encounters yet. Log your first one!</p>
        <%= link_to "Log Encounter", new_encounter_path, class: "btn primary" %>
      </div>
    <% end %>
  </section>

  <!-- Floating Action Button -->
  <%= link_to new_encounter_path, class: "fab", title: "Quick Add" do %>
    <span class="fab-icon">➕</span>
  <% end %>
</div>